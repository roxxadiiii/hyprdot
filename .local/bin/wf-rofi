#!/bin/bash

SAVE_DIR="$HOME/Videos/Recordings"
mkdir -p "$SAVE_DIR"

# 1. Prompt for filename
FILENAME=$(rofi -dmenu -p "Filename (without .mp4):")
if [[ -z "$FILENAME" ]]; then
    notify-send "wf-recorder" "Cancelled: No filename"
    exit 1
fi
OUTFILE="$SAVE_DIR/$FILENAME.mp4"

# 2. Ask to record audio
AUDIO=$(echo -e "Yes\nNo" | rofi -dmenu -p "Record audio?")
if [[ -z "$AUDIO" ]]; then
    notify-send "wf-recorder" "Cancelled: No audio option"
    exit 1
fi

# 3. Ask for screen mode
MODE=$(echo -e "Full screen\nSelect region" | rofi -dmenu -p "Recording mode")
if [[ -z "$MODE" ]]; then
    notify-send "wf-recorder" "Cancelled: No screen mode"
    exit 1
fi

# 4. Build wf-recorder command
CMD="wf-recorder -f \"$OUTFILE\""
[[ "$AUDIO" == "Yes" ]] && CMD+=" -a"
if [[ "$MODE" == "Select region" ]]; then
    GEOM=$(slurp)
    if [[ -z "$GEOM" ]]; then
        notify-send "wf-recorder" "Cancelled: No region selected"
        exit 1
    fi
    CMD+=" -g $GEOM"
fi

# 5. Confirm recording
CONFIRM=$(echo -e "Start recording\nCancel" | rofi -dmenu -p "Confirm recording: $FILENAME.mp4")
if [[ "$CONFIRM" != "Start recording" ]]; then
    notify-send "wf-recorder" "Cancelled by user"
    exit 1
fi

# 6. Start recording
notify-send "wf-recorder" "Recording started to $OUTFILE"
eval "$CMD"

