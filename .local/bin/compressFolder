#!/bin/bash

# Check for required input
if [ -z "$1" ]; then
    echo "Usage: $0 <target-directory>"
    exit 1
fi

# Input directory
TARGET_DIR="$1"

# Ensure 7z is available
if ! command -v 7z &> /dev/null; then
    echo "7z could not be found. Please install p7zip or 7zip-full."
    exit 2
fi

# Go to the target directory
cd "$TARGET_DIR" || { echo "Directory not found: $TARGET_DIR"; exit 3; }

# Loop through each folder
for folder in */ ; do
    # Remove trailing slash from folder name
    foldername="${folder%/}"
    archive_name="${foldername}.7z"
    
    echo "Compressing '$foldername' into '$archive_name'..."

    # Compress using maximum compression level
    7z a -t7z -mx=9 "$archive_name" "$foldername"

    echo "Done: $archive_name"
done

